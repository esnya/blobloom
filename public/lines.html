<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Line Counts</title>
    <style>
      svg {
        font-family: sans-serif;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>File Line Counts</h1>
    <svg id="chart"></svg>
    <script type="module">
      import * as d3 from 'https://cdn.jsdelivr.net/npm/d3@7/+esm';

      const data = await fetch('/api/lines').then((res) => res.json());

      const barHeight = 20;
      const margin = { left: 200, right: 20, top: 20, bottom: 20 };
      const width = 800;
      const height = barHeight * data.length + margin.top + margin.bottom;

      const svg = d3
        .select('#chart')
        .attr('width', width)
        .attr('height', height);

      const x = d3
        .scaleLinear()
        .domain([0, d3.max(data, (d) => d.lines)])
        .range([0, width - margin.left - margin.right]);

      const g = svg
        .append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

      g.selectAll('rect')
        .data(data)
        .join('rect')
        .attr('y', (_, i) => i * barHeight)
        .attr('width', (d) => x(d.lines))
        .attr('height', barHeight - 1)
        .attr('fill', 'steelblue');

      g.selectAll('text')
        .data(data)
        .join('text')
        .attr('x', -5)
        .attr('y', (_, i) => i * barHeight + (barHeight - 1) / 2)
        .attr('dy', '0.35em')
        .attr('text-anchor', 'end')
        .text((d) => d.file);
    </script>
  </body>
</html>
